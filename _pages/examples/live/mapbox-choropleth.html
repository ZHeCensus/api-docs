---
permalink: /examples/live/mapbox-choropleth/
---
<html>

<head>
  <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.js"></script>
  <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.css" rel="stylesheet" />
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.4/chroma.min.js"></script> -->
  <script src="./citysdk.js"></script>
</head>

<body>
  <style>
    body {
      margin: 0;
      padding: 0;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    #features {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      width: 300px;
      overflow: auto;
      background: rgba(255, 255, 255, 0.8);
    }
  </style>
  <div id="map"></div>
  <pre id='features'></pre>
  <script>
    mapboxgl.accessToken =
      "pk.eyJ1Ijoib3BlbmlkZW8iLCJhIjoiY2pnemR0dmwyMHVhdDJ2bGV1bnl6amJqaiJ9._G3sOFQoJZklpO9pscg1mw";

    var map = new mapboxgl.Map({
      container: "map",
      style: "mapbox://styles/mapbox/streets-v11",
      center: {
        lat: 37.0902,
        lng: -95.7129
      },
      zoom: 3
    });

    map.on("load", function () {

      census({
          vintage: 2017,
          geoHierarchy: {
            county: "*"
          },
          sourcePath: ["acs", "acs5"],
          values: ["B19083_001E"]
        },
        function (error, response) {

          map.addSource('counties', {
            type: 'vector',
            tiles: [
              "https://gis-server.data.census.gov/arcgis/rest/services/Hosted/VT_2017_050_00_PY_D1/VectorTileServer/tile/{z}/{y}/{x}.pbf"
            ]
          });


          map.on('data', dataMerge);

          function dataMerge(data) {
            if (data.dataType === 'source' && map.isSourceLoaded('counties')) {

              response.forEach(function (row) {
                map.setFeatureState({
                  source: "counties",
                  sourceLayer: "County",
                  id: row.county // GEOID
                }, {
                  GINI_INDEX: row.B19083_001E // GINI Index
                })
              });
              map.off('data', dataMerge)
            }
          }

          map.on('click', function (e) {
            var features = map.queryRenderedFeatures(e.point);
            document.getElementById('features').innerHTML = JSON.stringify(features, null, 2);
          });


          // map.querySourceFeatures('counties', {
          //   sourceLayer: 'County'
          // })

          map.addLayer({
            id: 'counties-join',
            type: 'fill',
            source: 'counties',
            'source-layer': 'County',
            paint: {
              'fill-color': [
                'interpolate',
                ['linear'],
                ['get', 'GINI_INDEX'],
                0.3271, '#d9d9d9',
                0.4162, '#b5b5b5',
                0.4354, '#919191',
                0.45234, '#6e6e6e',
                0.47502, '#4a4a4a',
                0.6202, '#262626'
              ],
              'fill-opacity': 0.75
            }
          });
        }
      )
    })
  </script>
</body>

</html>